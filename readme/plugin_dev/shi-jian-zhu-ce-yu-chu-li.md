# 事件注册与处理

事件，可以说是插件开发的核心与基础。大多数用例中，插件的主要工作都是在接收到某些特定事件后对其做出响应。我们常见的诸如关键词匹配，上下文处理等功能，也是建立在接收并响应事件的这个基础上的。

在RainyBot中，事件分为以下几大类型：Bot自身事件，好友事件，群组事件，消息事件，请求事件，其它客户端事件，动作事件。其中的每种事件类型，还细分了许多不同的具体事件，诸如群组事件->群组更名事件，消息事件->好友消息事件等，这些您都可以在[RainyBot API](../api/)中看到具体的划分与相关文档。

要通过插件对这些事件进行响应和处理，我们需要在插件中将所需事件_**注册并绑定**_到插件中的内置或自定义函数中。要这么做十分简单，就像在前面的渐进式教程中尝试过的那样——大部分情况下，我们将会在插件加载完毕时将执行的`_on_load()`虚函数中，通过调用`register_event()`函数来注册并绑定一个事件。当然，在特殊情况下您也可以在`_on_load()`虚函数以外的地方进行事件注册。

`register_event()`函数的用法十分简单，先让我们简单的看一下API中是如何介绍的：

> * void **register\_event (** [Variant](https://docs.godotengine.org/en/latest/classes/class\_variant.html) event, [Variant](https://docs.godotengine.org/en/latest/classes/class\_variant.html) function, [int](https://docs.godotengine.org/en/latest/classes/class\_int.html) priority, [int](https://docs.godotengine.org/en/latest/classes/class\_int.html) block\_mode **)**
>
> 用于注册一个或多个事件并将其绑定到一个或多个函数，事件发生时将触发绑定的函数并传入事件实例
>
> 需要的参数从左到右分别为:
>
> 事件的类型:
>
> * 此处可传入单个事件类型名，或一个包含了任意数量事件类型名的数组以批量注册事件
> * 传入的事件需要直接或间接继承\[Event]类，如[GroupMessageEvent](../api/%E7%BE%A4%E6%B6%88%E6%81%AF%E4%BA%8B%E4%BB%B6/)
>
> 事件绑定的函数名:
>
> * 此处可传入单个函数名，或一个包含了任意数量函数名的数组以批量绑定函数
> * 当对应事件发生时将依次传递并触发绑定的函数，绑定的函数需要定义一个参数用于接收事件实例
> * 注意: 绑定的函数中不建议直接包含使用await关键字关键字的任何语句，否则会出现运行时错误提示 (但不影响正常运行)
> * 您可以通过将使用了await的所有关联语句移动到其它函数，并在绑定的函数中调用这个函数来消除错误提示
>
> 事件的全局优先级(可选,默认为0):
>
> * 在多个插件同时注册了同一事件后，事件发生时将按照优先级由高到低的顺序传递事件到对应的插件
> * 优先级相同时，将根据注册事件的时间顺序来依次传递事件
>
> 事件的阻断模式(可选,默认为BlockMode.ALL):
>
> * 事件绑定的函数若返回true，将阻断事件被传递到后续函数或插件中 (异步函数无效)
> * 阻断的具体行为将由阻断模式决定, 每种阻断模式的具体效果请参见上方的BlockMode枚举

如果您觉得看上去有些混乱，没关系，让我们来一步步了解一下每个参数的作用及用法。

首先，在第一个参数中，我们需要指定要注册哪个/哪些事件。如果您只需注册单个事件，则只需直接填入事件的名称即可，如`FriendMessageEvent`。如果您要同时注册多个事件，则需填入一个包含了不同事件名称的数组，如`[FriendMessageEvent, GroupMessageEvent]`将会同时注册好友消息与群消息事件。
